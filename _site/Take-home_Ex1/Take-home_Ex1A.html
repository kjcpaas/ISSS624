<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kristine Joy Paas">
<meta name="dcterms.date" content="2023-11-24">

<title>ISSS624 - Take Home Exercise 1A: Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISSS624</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex1/Hands-on_Ex1A.html" rel="" target="">
 <span class="dropdown-text">1A: Data Wrangling with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex1/Hands-on_Ex1B.html" rel="" target="">
 <span class="dropdown-text">1B: Choropleth Mapping with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex2/Hands-on_Ex2A.html" rel="" target="">
 <span class="dropdown-text">2A: Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex2/Hands-on_Ex2B.html" rel="" target="">
 <span class="dropdown-text">2B: Global Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex2/Hands-on_Ex2C.html" rel="" target="">
 <span class="dropdown-text">2C: Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex3/Hands-on_Ex3.html" rel="" target="">
 <span class="dropdown-text">3: Processing and Visualizing Flow Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../In-class_Ex1/In-class_Ex1.html" rel="" target="">
 <span class="dropdown-text">1: Bus Commuter Flow by Origin</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex2/In-class_Ex2A.html" rel="" target="">
 <span class="dropdown-text">2A: Spatial Weights with sfdep</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex2/In-class_Ex2B.html" rel="" target="">
 <span class="dropdown-text">2B: GLSA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex2/In-class_Ex2C.html" rel="" target="">
 <span class="dropdown-text">2C: EHSA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex3/In-class_Ex3.html" rel="" target="">
 <span class="dropdown-text">3: Calibrating Spatial Interactions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../Take-home_Ex1/Take-home_Ex1.html" rel="" target="">
 <span class="dropdown-text">1: Geospatial Analytics for Public Good (combined)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#preparing-the-data-sets" id="toc-preparing-the-data-sets" class="nav-link" data-scroll-target="#preparing-the-data-sets">Preparing the data sets</a>
  <ul class="collapse">
  <li><a href="#geospatial" id="toc-geospatial" class="nav-link" data-scroll-target="#geospatial">Geospatial</a></li>
  <li><a href="#aspatial" id="toc-aspatial" class="nav-link" data-scroll-target="#aspatial">Aspatial</a></li>
  </ul></li>
  <li><a href="#preparing-the-data-directory" id="toc-preparing-the-data-directory" class="nav-link" data-scroll-target="#preparing-the-data-directory">Preparing the <code>data/</code> directory</a></li>
  <li><a href="#setting-up-the-r-environment" id="toc-setting-up-the-r-environment" class="nav-link" data-scroll-target="#setting-up-the-r-environment">Setting Up the R Environment</a></li>
  <li><a href="#environment-settings" id="toc-environment-settings" class="nav-link" data-scroll-target="#environment-settings">Environment Settings</a></li>
  <li><a href="#running-the-setup" id="toc-running-the-setup" class="nav-link" data-scroll-target="#running-the-setup">Running the setup</a></li>
  </ul></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a>
  <ul class="collapse">
  <li><a href="#goal-data-sets" id="toc-goal-data-sets" class="nav-link" data-scroll-target="#goal-data-sets">Goal data sets</a></li>
  </ul></li>
  <li><a href="#generating-hexagons-from-busstop-data" id="toc-generating-hexagons-from-busstop-data" class="nav-link" data-scroll-target="#generating-hexagons-from-busstop-data">Generating hexagons from <em>BusStop</em> data</a>
  <ul class="collapse">
  <li><a href="#importing-the-singapore-boundary-data" id="toc-importing-the-singapore-boundary-data" class="nav-link" data-scroll-target="#importing-the-singapore-boundary-data">Importing the Singapore boundary data</a></li>
  <li><a href="#importing-the-busstop-data-set" id="toc-importing-the-busstop-data-set" class="nav-link" data-scroll-target="#importing-the-busstop-data-set">Importing the BusStop data set</a></li>
  <li><a href="#generating-hexagons-from-singapore-boundary-data" id="toc-generating-hexagons-from-singapore-boundary-data" class="nav-link" data-scroll-target="#generating-hexagons-from-singapore-boundary-data">Generating hexagons from Singapore boundary data</a></li>
  <li><a href="#filtering-hexagons-with-bus-stops" id="toc-filtering-hexagons-with-bus-stops" class="nav-link" data-scroll-target="#filtering-hexagons-with-bus-stops">Filtering hexagons with bus stops</a></li>
  <li><a href="#assigning-ids-to-each-hexagon" id="toc-assigning-ids-to-each-hexagon" class="nav-link" data-scroll-target="#assigning-ids-to-each-hexagon">Assigning ids to each hexagon</a></li>
  </ul></li>
  <li><a href="#extracting-hourly-of-bus-trips-originating-from-hexagons" id="toc-extracting-hourly-of-bus-trips-originating-from-hexagons" class="nav-link" data-scroll-target="#extracting-hourly-of-bus-trips-originating-from-hexagons">Extracting Hourly # of Bus Trips Originating from Hexagons</a>
  <ul class="collapse">
  <li><a href="#importing-the-data-set" id="toc-importing-the-data-set" class="nav-link" data-scroll-target="#importing-the-data-set">Importing the data set</a></li>
  <li><a href="#cleaning-the-data" id="toc-cleaning-the-data" class="nav-link" data-scroll-target="#cleaning-the-data">Cleaning the data</a></li>
  <li><a href="#mapping-the-bus-stops-to-hexagon" id="toc-mapping-the-bus-stops-to-hexagon" class="nav-link" data-scroll-target="#mapping-the-bus-stops-to-hexagon">Mapping the bus stops to hexagon</a></li>
  <li><a href="#adding-hex_id-information-to-bus-trips-data" id="toc-adding-hex_id-information-to-bus-trips-data" class="nav-link" data-scroll-target="#adding-hex_id-information-to-bus-trips-data">Adding <code>HEX_ID</code> information to bus <code>trips</code> data</a></li>
  <li><a href="#aggregating-trips-based-on-hex_id" id="toc-aggregating-trips-based-on-hex_id" class="nav-link" data-scroll-target="#aggregating-trips-based-on-hex_id">Aggregating <code>TRIPS</code> based on <code>HEX_ID</code></a></li>
  </ul></li>
  <li><a href="#generating-time-series-cube-friendly-data" id="toc-generating-time-series-cube-friendly-data" class="nav-link" data-scroll-target="#generating-time-series-cube-friendly-data">Generating time series cube-friendly data</a>
  <ul class="collapse">
  <li><a href="#generating-the-combinations" id="toc-generating-the-combinations" class="nav-link" data-scroll-target="#generating-the-combinations">Generating the combinations</a></li>
  <li><a href="#splitting-the-data" id="toc-splitting-the-data" class="nav-link" data-scroll-target="#splitting-the-data">Splitting the data</a></li>
  <li><a href="#filling-in-the-all-the-combos" id="toc-filling-in-the-all-the-combos" class="nav-link" data-scroll-target="#filling-in-the-all-the-combos">Filling in the all the combos</a></li>
  <li><a href="#filling-in-missing-values" id="toc-filling-in-missing-values" class="nav-link" data-scroll-target="#filling-in-missing-values">Filling in missing values</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 1A: Data Wrangling</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kristine Joy Paas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 24, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">December 3, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>The aim of this study is to uncover spatial and spatio-temporal mobility patterns of public bus passengers in Singapore.</p>
<p>The main modes of analysis to be used here are Local Indicators of Spatial Association (GLISA) and Emerging Hot Spot Analysis (EHSA).</p>
<p>In doing these study, we will be looking at bus trips started during the hours below.</p>
<table class="table">
<thead>
<tr class="header">
<th>Peak hour period</th>
<th>Bus tap on time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Weekday morning peak</td>
<td>6am to 9am</td>
</tr>
<tr class="even">
<td>Weekday evening peak</td>
<td>5pm to 8pm</td>
</tr>
<tr class="odd">
<td>Weekend/holiday morning peak</td>
<td>11am to 2pm</td>
</tr>
<tr class="even">
<td>Weekend/holiday evening peak</td>
<td>4pm to 7pm</td>
</tr>
</tbody>
</table>
<p>More details about the study can be found <a href="https://isss624-ay2023-24nov.netlify.app/take-home_ex01">here</a>.</p>
<p>In this part of the study, we will do <strong>data wrangling</strong> on the data sets so that they are transformed into a form that can be used for geovisualization and spatial analysis.</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<section id="preparing-the-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data-sets">Preparing the data sets</h2>
<section id="geospatial" class="level3">
<h3 class="anchored" data-anchor-id="geospatial">Geospatial</h3>
<p>This data sets are in <code>shp</code> format.</p>
<ul>
<li>Bus Stop Locations, available publicly from <a href="https://datamall.lta.gov.sg/content/datamall/en.html">LTA DataMall</a></li>
</ul>
</section>
<section id="aspatial" class="level3">
<h3 class="anchored" data-anchor-id="aspatial">Aspatial</h3>
<p>These data sets are in <code>csv</code> format.</p>
<ul>
<li>Master Plan 2019 Subzone Boundary (Web), originally from <a href="https://data.gov.sg/">data.gov.sg</a> but used the one provided on <a href="https://elearn.smu.edu.sg/d2l/home/357628">E-learn</a>.</li>
<li>Passenger Volume By Origin Destination Bus Stops from <a href="https://datamall.lta.gov.sg/content/datamall/en.html">LTA DataMall</a> via API (need to <a href="https://datamall.lta.gov.sg/content/datamall/en/request-for-api.html">request for access</a>)
<ul>
<li><p>August 2023</p></li>
<li><p>September 2023</p></li>
<li><p>October 2023 - we will focus on this as the <strong>main data set</strong></p></li>
</ul></li>
</ul>
</section>
</section>
<section id="preparing-the-data-directory" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data-directory">Preparing the <code>data/</code> directory</h2>
<p>Before starting our analysis, we have to organize the data sets in a directory.</p>
<ul>
<li><p>Geospatial data will be located under <code>data/geospatial</code></p></li>
<li><p>Aspatial data will be located under <code>data/aspatial</code></p></li>
<li><p><code>data/rds</code> to be created to store data that we can reuse and to make our code reproduceable.</p></li>
</ul>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show file structure
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Take-home_Ex1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> data</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> aspatial</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── origin_destination_bus_202308.csv</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── origin_destination_bus_202309.csv</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── origin_destination_bus_202310.csv</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> geospatial</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.cpg</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.dbf</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.lyr</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.prj</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.sbn</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.sbx</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.shp</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.shp.xml</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── BusStop.shx</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── MPSZ-2019.cpg</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── MPSZ-2019.dbf</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── MPSZ-2019.prj</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── MPSZ-2019.qmd</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── MPSZ-2019.shp</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── MPSZ-2019.shx</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> rds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="setting-up-the-r-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-r-environment">Setting Up the R Environment</h2>
<p>After preparing the data sets, we can finally proceed to load the R packages needed for this study.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
R packages used
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/tmap/index.html"><strong>tmap</strong></a>: for thematic mapping</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/sf/index.html"><strong>sf</strong></a>: for geospatial data handling</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/tidyverse/index.html"><strong>tidyverse</strong></a>: for non-spatial data handling</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/knitr/"><strong>knitr</strong></a>:for prettifying presentation</p></li>
<li><p><a href="https://sfdep.josiahparry.com/"><strong>sfdep</strong></a>: for spatial analysis</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="environment-settings" class="level2">
<h2 class="anchored" data-anchor-id="environment-settings">Environment Settings</h2>
<p>We will also set the default settings on for this document</p>
<ul>
<li><p><code>tmap_mode</code> to <strong>plot</strong>: for plotting simple maps</p></li>
<li><p><code>tmap_style</code> to <strong>natural</strong>: for my preferred mapping style</p></li>
<li><p>set <strong>seed</strong> for reproducibility of results</p></li>
</ul>
</section>
<section id="running-the-setup" class="level2">
<h2 class="anchored" data-anchor-id="running-the-setup">Running the setup</h2>
<p>We will label this code chunk as the setup chunk so the R runs it even after the environment restarts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, tmap, tidyverse, knitr, sfdep)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_style</span>(<span class="st">"natural"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<p>After setting up the data sets and the R environment, we can finally proceed with data wrangling.</p>
<section id="goal-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="goal-data-sets">Goal data sets</h2>
<p>To enable the visualization and analysis in latter part of the study, we need to have the following data sets:</p>
<ul>
<li><p><strong>Honeycomb</strong> geometry, a tessellation of hexagons covering the bus stops in Singapor</p></li>
<li><p><strong>Hourly bus trips started</strong> from each hexagon cell</p>
<ul>
<li><p>1 for weekend, 1 for weekend/holidays</p></li>
<li><p>Required columns: <code>HEX_ID</code>, <code>HOUR_OF_DAY</code>, <code>TRIPS</code></p></li>
<li><p>Must contain geometry of the hexagon</p></li>
<li><p>Can be used to generate a time series cube</p></li>
</ul></li>
</ul>
<p>As the wrangling process is expected to have a lot of intermediate steps, <strong>Save</strong>, <strong>Load</strong>, and <strong>Data clear</strong> points are available to make our data wrangling more efficient.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save point
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is where data is written as <code>rds</code> files using <code>write_rds()</code> for important data sets that will be used in later analysis. Examples are:</p>
<ul>
<li><p>The end goal of data wrangling: <strong>Hourly bus trips started</strong> <strong>from each hexagon cell</strong> data sets</p></li>
<li><p>Critical outputs of expensive calculations</p></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Load point
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is where data is loaded from <code>rds</code> files using <code>read_rds()</code>. They were previously generated by the save point.</p>
<p><strong>TIP</strong>: Skip to the load points to progress without running the code above it</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data clear point
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is where data that will not be used anymore are cleared. The data in RStudio environment will pile up and set <code>#| eval: false</code> in code chunks if you want skip the clearing. For example, the code below won’t be run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>message <span class="ot">&lt;-</span> <span class="st">"This code chunk executed"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="generating-hexagons-from-busstop-data" class="level1">
<h1>Generating hexagons from <em>BusStop</em> data</h1>
<p>As per the specifications of this study, we must use a honeycomb grid, a tesselation of hexagons to replace the <code>mpsz</code> data set.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why hexagons?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some benefits of using a hexagons are:</p>
<ul>
<li><p>A hexagon is the polygon with the most number of sides that can tessellate (or tile). Hence it is the most “circular” of the polygons that can be tessellated.</p></li>
<li><p>Distances of the centroid from one hexagon to the next are consistent all around the hexagon, making it easy to find neighbors.</p></li>
</ul>
<p>More information about hexagons in the context of spatial analysis can be found in <a href="https://desktop.arcgis.com/en/arcmap/latest/tools/spatial-statistics-toolbox/h-whyhexagons.htm" class="uri">https://desktop.arcgis.com/en/arcmap/latest/tools/spatial-statistics-toolbox/h-whyhexagons.htm</a></p>
</div>
</div>
<section id="importing-the-singapore-boundary-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-singapore-boundary-data">Importing the Singapore boundary data</h2>
<p>We will use the <strong>Master Plan 2019 Subzone Boundary (Web)</strong> data set that has been used in class. This is a <code>shp</code> file, that we will import by using <code>st_read()</code>. We will use this to <strong>ensure that the bus stops are within Singapore.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">layer =</span> <span class="st">"MPSZ-2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MPSZ-2019' from data source 
  `/Users/kjcpaas/Documents/Grad School/ISSS624/Project/ISSS624/Take-home_Ex1/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correcting the projection
</div>
</div>
<div class="callout-body-container callout-body">
<p>This data frame using the global GPS standard projection, <a href="https://gisgeography.com/wgs84-world-geodetic-system/"><strong>WGS84</strong></a>. We need to convert this to <a href="https://app.sla.gov.sg/sirent/About/PlaneCoordinateSystem"><strong>SVY21</strong></a> that is more appropriate for Singapore 🇸🇬 context.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> mpsz <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save point
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s save this geometry with corrected projection from plotting purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mpsz, <span class="st">"data/rds/mpsz.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="cell">
<details>
<summary><strong>Show the code</strong></summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_style</span>(<span class="st">"natural"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"lightgreen"</span>, <span class="at">title =</span> <span class="st">"Singapore Boundary"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Map of Singapore"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1A_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="importing-the-busstop-data-set" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-busstop-data-set">Importing the BusStop data set</h2>
<p>The <code>BusStop</code> data set is a in <code>shp</code> format. We can import it by using <code>st_read()</code> from the <code>sf</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>busstops <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">layer =</span> <span class="st">"BusStop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BusStop' from data source 
  `/Users/kjcpaas/Documents/Grad School/ISSS624/Project/ISSS624/Take-home_Ex1/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 5161 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3970.122 ymin: 26482.1 xmax: 48284.56 ymax: 52983.82
Projected CRS: SVY21</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correcting the projection
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We want to use <a href="https://app.sla.gov.sg/sirent/About/PlaneCoordinateSystem">SVY21</a> as the projection for this study as it is the projection used for local Singaporean context.</p>
<p>After the import, it shows that the <strong>Projected CRS</strong>is <strong>SVY21</strong>. However, checking the CRS with <code>st_crs()</code> tells a different story.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(busstops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: SVY21 
  wkt:
PROJCRS["SVY21",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]],
            ID["EPSG",6326]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["Degree",0.0174532925199433]]],
    CONVERSION["unnamed",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",1.36666666666667,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",103.833333333333,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",1,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",28001.642,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",38744.572,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]</code></pre>
</div>
</div>
<p>As we can see EPSG value is <strong>9001</strong>, which correspond to <a href="https://gisgeography.com/wgs84-world-geodetic-system/"><strong>WGS84</strong></a>. We have to fix the projection by transforming to EPSG value of <strong>3414</strong>, which corresponds to <strong>SVY21</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>busstops <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(busstops, <span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Next, let’s take a look at the available columns to identify which columns we can use for analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(busstops))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 30%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">BUS_STOP_N</th>
<th style="text-align: left;">BUS_ROOF_N</th>
<th style="text-align: left;">LOC_DESC</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">22069</td>
<td style="text-align: left;">B06</td>
<td style="text-align: left;">OPP CEVA LOGISTICS</td>
<td style="text-align: left;">POINT (13576.31 32883.65)</td>
</tr>
<tr class="even">
<td style="text-align: left;">32071</td>
<td style="text-align: left;">B23</td>
<td style="text-align: left;">AFT TRACK 13</td>
<td style="text-align: left;">POINT (13228.59 44206.38)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">44331</td>
<td style="text-align: left;">B01</td>
<td style="text-align: left;">BLK 239</td>
<td style="text-align: left;">POINT (21045.1 40242.08)</td>
</tr>
<tr class="even">
<td style="text-align: left;">96081</td>
<td style="text-align: left;">B05</td>
<td style="text-align: left;">GRACE INDEPENDENT CH</td>
<td style="text-align: left;">POINT (41603.76 35413.11)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11561</td>
<td style="text-align: left;">B05</td>
<td style="text-align: left;">BLK 166</td>
<td style="text-align: left;">POINT (24568.74 30391.85)</td>
</tr>
<tr class="even">
<td style="text-align: left;">66191</td>
<td style="text-align: left;">B03</td>
<td style="text-align: left;">AFT CORFE PL</td>
<td style="text-align: left;">POINT (30951.58 38079.61)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>From this initial look in the data, <strong><code>BUS_STOP_N</code></strong> and <strong><code>LOC_DESC</code></strong> can potentially be used to match records in the passenger volume data set.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Changing columns to factor
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>BUS_STOP_N</code> has a finite set of values that we do not need to process sequentially so we will convert it as <em>factor</em> to make it easier to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>busstops<span class="sc">$</span>BUS_STOP_N <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(busstops<span class="sc">$</span>BUS_STOP_N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="generating-hexagons-from-singapore-boundary-data" class="level2">
<h2 class="anchored" data-anchor-id="generating-hexagons-from-singapore-boundary-data">Generating hexagons from Singapore boundary data</h2>
<p>Following the steps from <a href="https://urbandatapalette.com/post/2021-08-tessellation-sf/" class="uri">https://urbandatapalette.com/post/2021-08-tessellation-sf/</a>, we will use <a href="https://search.r-project.org/CRAN/refmans/sf/html/st_make_grid.html">st_make_grid()</a> to generate the hexagons for analysis.</p>
<p>We need to provide a value for <code>cellsize</code> in the function, which is defined as <em>“for hexagonal cells the distance between opposite edges”</em>. We need to create hexagons whose apothem is <strong>250m</strong>, resulting in a cell size of <strong>500m</strong>.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why is cell size 500 m?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><a href="https://www.merriam-webster.com/dictionary/apothem">Apothem</a> is defined as <em>the perpendicular from the center of a regular polygon to one of the sides<strong>.</strong></em></p>
<p>The specification is this study requires hexagons to be <strong>250 m</strong> from the center of the hexagon to the center of one of it’s edge.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/apothem.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>As such, this corresponds to the length of 2 opposite apothems, which is <strong>500 m.</strong></p>
<p>The edge length is <strong>not</strong> the same as apothem. It is <strong>288.675</strong>m.</p>
<p><span class="math display">\[
250m/cos(30) = 288.675m
\]</span></p>
</div>
</div>
</div>
<p>We will use the <code>mpsz</code> data to ensure that the honeycomb grid perfectly covers the Singapore boundaries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>honeycomb <span class="ot">&lt;-</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_grid</span>(mpsz,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">cellsize =</span> <span class="dv">500</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">what =</span> <span class="st">"polygon"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">square =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>We have to use <code>st_sf()</code> to convert the result to a data frame that can be used for the succeeding steps.</p>
</div>
</div>
</div>
<p>Checking the generated hexagons reveals that it covers all the bus stops.</p>
<div class="cell">
<details>
<summary><strong>Show the code</strong></summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(honeycomb) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"white"</span>, <span class="at">title =</span> <span class="st">"Hexagons"</span>) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Singapore with honeycomb grid"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"green"</span>, <span class="at">title =</span> <span class="st">"Singapore Boundary"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(busstops) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.005</span>, <span class="at">title =</span> <span class="st">"Bus Stops"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1A_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>Checking the scale reveals that the generated hexagons are of the expected size, <strong>500 m from one edge to the opposite edge</strong> as there are <strong>10 hexagons within a 5 km</strong> <strong>distance</strong>.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About those points outside Singapore
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The map shows that there are bus stops in our data set that our outside Singapore bounds (green area). We can remove these points from our <code>busstops</code> data by following the filtering steps from <a href="https://urbandatapalette.com/post/2021-08-tessellation-sf/" class="uri">https://urbandatapalette.com/post/2021-08-tessellation-sf/</a>.</p>
<p>We will <code>st_intersects()</code> to see which points in <code>busstops</code> intersect with <code>mpsz</code>, and filter those that intersect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>busstops<span class="sc">$</span>n_collisions <span class="ot">=</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(busstops, mpsz))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>busstops <span class="ot">&lt;-</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(busstops, n_collisions <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(, <span class="sc">-</span>n_collisions) <span class="co"># Remove n_collisions as we do not need it anymore</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting again shows that all bus stops are now within Singapore bounds.</p>
<div class="cell">
<details>
<summary><strong>Show the code</strong></summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(honeycomb) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"white"</span>, <span class="at">title =</span> <span class="st">"Hexagons"</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Honeycomb grid without bus stops outside of Singapore"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"green"</span>, <span class="at">title =</span> <span class="st">"Singapore Boundary"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(busstops) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.005</span>, <span class="at">title =</span> <span class="st">"Bus Stops"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1A_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="filtering-hexagons-with-bus-stops" class="level2">
<h2 class="anchored" data-anchor-id="filtering-hexagons-with-bus-stops">Filtering hexagons with bus stops</h2>
<p>The honeycomb grid generated from <a href="#generating-hexagons-from-singapore-boundary-data">Generating hexagons from Singapore boundary data</a> need to be filtered such that the hexagons remaining correspond to only those with bus stops.</p>
<p>We can do this by following the filtering steps from <a href="https://urbandatapalette.com/post/2021-08-tessellation-sf/" class="uri">https://urbandatapalette.com/post/2021-08-tessellation-sf/</a>. We will use <code>st_intersects()</code> to identify <strong>which hexagons intersect with bus stop locations</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>honeycomb<span class="sc">$</span>n_collisions <span class="ot">=</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(honeycomb, busstops))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>honeycomb <span class="ot">&lt;-</span> <span class="fu">filter</span>(honeycomb, n_collisions <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s generate the map again to check if we have the hexagons that correspond to bus stop locations.</p>
<div class="cell">
<details>
<summary><strong>Show the code</strong></summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"green"</span>, <span class="at">title =</span> <span class="st">"Singapore Boundary"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(honeycomb) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"white"</span>, <span class="at">title =</span> <span class="st">"Hexagons"</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Honeycomb grid corresponding to Singapore bus stops"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.0</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.35</span>, </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">bg.color =</span> <span class="st">"white"</span>, <span class="at">bg.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(busstops) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.001</span>, <span class="at">title =</span> <span class="st">"Bus Stops"</span>) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex1A_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="assigning-ids-to-each-hexagon" class="level2">
<h2 class="anchored" data-anchor-id="assigning-ids-to-each-hexagon">Assigning ids to each hexagon</h2>
<p>Here is the structure of our honeycomb data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(honeycomb, <span class="at">n=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">geometry</th>
<th style="text-align: right;">n_collisions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">POLYGON ((3917.538 28017.41…</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4417.538 30615.49…</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POLYGON ((4667.538 28450.43…</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-simple callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remove n-collisions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We do not need <code>n-collisions</code> anymore so we can remove it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>honeycomb <span class="ot">&lt;-</span> honeycomb <span class="sc">%&gt;%</span> <span class="fu">select</span>(, <span class="sc">-</span>n_collisions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>This data is still incomplete as we need to associate the hexagons to aspatial data, which is critical to the next steps in our data wrangling.</p>
<p>For this purpose, we will assign <code>HEX_ID</code> with format <code>H0000</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>honeycomb<span class="sc">$</span>HEX_ID <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"H%04d"</span>, <span class="fu">seq_len</span>(<span class="fu">nrow</span>(honeycomb))) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(honeycomb)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">geometry</th>
<th style="text-align: left;">HEX_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">POLYGON ((3917.538 28017.41…</td>
<td style="text-align: left;">H0001</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4417.538 30615.49…</td>
<td style="text-align: left;">H0002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POLYGON ((4667.538 28450.43…</td>
<td style="text-align: left;">H0003</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4667.538 30182.48…</td>
<td style="text-align: left;">H0004</td>
</tr>
<tr class="odd">
<td style="text-align: left;">POLYGON ((4667.538 31048.5,…</td>
<td style="text-align: left;">H0005</td>
</tr>
<tr class="even">
<td style="text-align: left;">POLYGON ((4917.538 28883.44…</td>
<td style="text-align: left;">H0006</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>honeycomb</code> is the <strong>geometry</strong> that we will use for analysis. It will be used for tasks such as identifying neighbors and calculating spatial weights.</p>
<p>Is it also one of the <a href="#goal-data-sets">Goal data sets</a> we need. Hence, we will save it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(honeycomb, <span class="st">"data/rds/honeycomb202310.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data clear point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We do not need <code>mpsz</code> anymore as we have generated hexagons already. For further analysis, we will overlay the hexagons to the Singapore map with <code>tmap_mode("plot")</code> to use interactive maps for closer inspection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(mpsz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="extracting-hourly-of-bus-trips-originating-from-hexagons" class="level1">
<h1>Extracting Hourly # of Bus Trips Originating from Hexagons</h1>
<p>The goal for this part of data wrangling is to have information on <strong>how many trips started from each hexagon for every given hour of the day</strong>.</p>
<p>We will use the <em>Passenger Volume By Origin Destination Bus Stops</em> from <a href="https://datamall.lta.gov.sg/content/datamall/en.html">LTA DataMall</a> via API for the months of <strong>August, September, October 2023</strong>.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>For demonstrating the steps, we will use the <strong>October 2023</strong> data set. The same steps will be applied to the other data sets later on.</p>
<p>If you want to run the code for <strong>August 2023</strong> and <strong>September 2023</strong>, replace <em>202310</em>, with <em>202308</em> or <em>202309<strong>.</strong></em> Our code can be used to analyze this dataset from any month.</p>
</div>
</div>
</div>
<section id="importing-the-data-set" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-data-set">Importing the data set</h2>
<p>The data set is an aspatial data in <code>csv</code> format so we will use <code>read_csv()</code> to import the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>odbus <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/origin_destination_bus_202310.csv"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(odbus))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">YEAR_MONTH</th>
<th style="text-align: left;">DAY_TYPE</th>
<th style="text-align: right;">TIME_PER_HOUR</th>
<th style="text-align: left;">PT_TYPE</th>
<th style="text-align: left;">ORIGIN_PT_CODE</th>
<th style="text-align: left;">DESTINATION_PT_CODE</th>
<th style="text-align: right;">TOTAL_TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-10</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: left;">BUS</td>
<td style="text-align: left;">04168</td>
<td style="text-align: left;">10051</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-10</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: left;">BUS</td>
<td style="text-align: left;">04168</td>
<td style="text-align: left;">10051</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-10</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">BUS</td>
<td style="text-align: left;">80119</td>
<td style="text-align: left;">90079</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-10</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">BUS</td>
<td style="text-align: left;">80119</td>
<td style="text-align: left;">90079</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-10</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: left;">BUS</td>
<td style="text-align: left;">44069</td>
<td style="text-align: left;">17229</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-10</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: left;">BUS</td>
<td style="text-align: left;">20281</td>
<td style="text-align: left;">20141</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The relevant columns for our data study are <strong><code>DAY_TYPE</code></strong>, <strong><code>TIME_PER_HOUR</code></strong>, <strong><code>ORIGIN_PT_CODE</code></strong>, <code>TOTAL_TRIPS</code></p>
<p>We do not need the <strong><code>DESTINATION_PT_CODE</code></strong> as we are only interested on <strong>when passengers get on the bus</strong>.</p>
<p>Furthermore, the <strong><code>ORIGIN_PT_CODE</code></strong> can be correlated to the <code>BUS_STOP_N</code> column of <code>busstops</code> data.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Recap of <code>busstops</code> data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(busstops))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 30%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">BUS_STOP_N</th>
<th style="text-align: left;">BUS_ROOF_N</th>
<th style="text-align: left;">LOC_DESC</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">22069</td>
<td style="text-align: left;">B06</td>
<td style="text-align: left;">OPP CEVA LOGISTICS</td>
<td style="text-align: left;">POINT (13576.31 32883.65)</td>
</tr>
<tr class="even">
<td style="text-align: left;">32071</td>
<td style="text-align: left;">B23</td>
<td style="text-align: left;">AFT TRACK 13</td>
<td style="text-align: left;">POINT (13228.59 44206.38)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">44331</td>
<td style="text-align: left;">B01</td>
<td style="text-align: left;">BLK 239</td>
<td style="text-align: left;">POINT (21045.1 40242.08)</td>
</tr>
<tr class="even">
<td style="text-align: left;">96081</td>
<td style="text-align: left;">B05</td>
<td style="text-align: left;">GRACE INDEPENDENT CH</td>
<td style="text-align: left;">POINT (41603.76 35413.11)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11561</td>
<td style="text-align: left;">B05</td>
<td style="text-align: left;">BLK 166</td>
<td style="text-align: left;">POINT (24568.74 30391.85)</td>
</tr>
<tr class="even">
<td style="text-align: left;">66191</td>
<td style="text-align: left;">B03</td>
<td style="text-align: left;">AFT CORFE PL</td>
<td style="text-align: left;">POINT (30951.58 38079.61)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="cleaning-the-data" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-the-data">Cleaning the data</h2>
<p>Before going deep in the wrangling, we will clean up the data so that we are left with a lightweight data set that R can process more easily. We will retain and rename columns below to make them more understandable and easier to join with other data sets.</p>
<ul>
<li><p><code>DAY_TYPE</code></p></li>
<li><p><code>TIME_PER_HOUR</code> -&gt; <code>HOUR_OF_DAY</code></p></li>
<li><p><code>ORIGIN_PT_CODE</code> -&gt; <code>BUS_STOP_N</code></p></li>
<li><p><code>TOTAL_TRIPS</code> -&gt; <code>TRIPS</code></p></li>
</ul>
<p>We will also rename the columns to make them more understandable and will make joining with other data sets easier.</p>
<p>Lastly, will also convert <code>BUS_STOP_N</code> to <em>factor</em> as it has a finite set of values so we can convert it to categorical data to make it easier to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> odbus <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(ORIGIN_PT_CODE, DAY_TYPE, TIME_PER_HOUR, TOTAL_TRIPS)) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">BUS_STOP_N =</span> ORIGIN_PT_CODE) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">HOUR_OF_DAY =</span> TIME_PER_HOUR) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">TRIPS =</span> TOTAL_TRIPS)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>trips<span class="sc">$</span>BUS_STOP_N <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trips<span class="sc">$</span>BUS_STOP_N)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trips))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">BUS_STOP_N</th>
<th style="text-align: left;">DAY_TYPE</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">04168</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">04168</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">80119</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">80119</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">44069</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">20281</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><code>select()</code> is used to select the columns we need.</p>
<p><code>rename()</code> is used to rename the columns.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data clear point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We do not need <code>odbus</code> anymore as we will be working with the more lightweight <code>trips</code> from this point on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(odbus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="mapping-the-bus-stops-to-hexagon" class="level2">
<h2 class="anchored" data-anchor-id="mapping-the-bus-stops-to-hexagon">Mapping the bus stops to hexagon</h2>
<p>In <a href="#filtering-hexagons-with-bus-stops">Filtering hexagons with bus stops</a> we were able to overlay the bus locations to our generated hexagon. While this is enough for visualization, it is <strong>not enough for the rest of the data processing</strong> we need.</p>
<p>From <a href="#cleaning-the-data">Cleaning the data</a>, we have the <code>BUS_STOP_N</code> in the that we can use to associate with <code>busstops</code>.</p>
<p>We need to create an <strong>aspatial</strong> table that contain <code>BUS_STOP_N</code> and <code>HEX_ID</code> of the hexagon containing them. We will use <code>st_intersection()</code>.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why aspatial?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We want to use generate a simple mapping here as this table will serve as a “glue” between the other aspatial data sets and our geospatial data, <code>honeycomb</code>.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bs_hex <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(busstops, honeycomb) <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(BUS_STOP_N, HEX_ID))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(bs_hex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">BUS_STOP_N</th>
<th style="text-align: left;">HEX_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">3265</td>
<td style="text-align: left;">25059</td>
<td style="text-align: left;">H0001</td>
</tr>
<tr class="even">
<td style="text-align: left;">254</td>
<td style="text-align: left;">26379</td>
<td style="text-align: left;">H0002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2566</td>
<td style="text-align: left;">25751</td>
<td style="text-align: left;">H0003</td>
</tr>
<tr class="even">
<td style="text-align: left;">2893</td>
<td style="text-align: left;">25761</td>
<td style="text-align: left;">H0003</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4199</td>
<td style="text-align: left;">26389</td>
<td style="text-align: left;">H0004</td>
</tr>
<tr class="even">
<td style="text-align: left;">2399</td>
<td style="text-align: left;">26369</td>
<td style="text-align: left;">H0005</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><code>st_intersection()</code> - find which hexagon contains the bus stop</p>
<p><code>st_drop_geometry()</code> - to make data aspatial</p>
<p><code>select()</code> - to retain only the relevant columns: <code>BUS_STOP_N</code> and <code>HEX_ID</code></p>
</div>
</div>
</div>
</section>
<section id="adding-hex_id-information-to-bus-trips-data" class="level2">
<h2 class="anchored" data-anchor-id="adding-hex_id-information-to-bus-trips-data">Adding <code>HEX_ID</code> information to bus <code>trips</code> data</h2>
<p>To achieve our goal of having the hourly # of bus trips per location, we need to add <code>HEX_ID</code> to <code>trips</code> data. This is so we can answer, <em>how many bus trip originate from a certain hexagon?</em></p>
<p>To do this, we will do an <code>inner_join()</code> to join the <code>trips</code> data with <code>bs_hex</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why `inner_join()` instead of `left_join()`?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We will use <code>inner_join</code> as there are <code>BUS_STOP_N</code> values in <code>trips</code> data that are not in <code>bs_hex</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>trips<span class="sc">$</span>BUS_STOP_N[<span class="sc">!</span>(trips<span class="sc">$</span>BUS_STOP_N <span class="sc">%in%</span> bs_hex<span class="sc">$</span>BUS_STOP_N)] <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 63</code></pre>
</div>
</div>
<p>There are <strong>57</strong> bus stops in <code>trips</code> that are not in <code>bs_hex</code>. <strong>5</strong> of this can be attributed the bus stops we removed in <a href="#about-those-points-outside-singapore">About those points outside Singapore</a>. Others may be due to the <em>BusStops</em> data set not having complete information.</p>
<p>Nonetheless, we have to <strong>remove</strong> these bus stops from our analysis as <strong>we do not have geospatial data</strong> to associate to the hexagons.</p>
<p>Therefore, we will use <code>inner_join</code> to keep only the observations in <code>trips</code> with the matching bus stops in <code>bs_hex</code>.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(trips, bs_hex)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trips))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">BUS_STOP_N</th>
<th style="text-align: left;">DAY_TYPE</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
<th style="text-align: left;">HEX_ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">04168</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">H0955</td>
</tr>
<tr class="even">
<td style="text-align: left;">04168</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">H0955</td>
</tr>
<tr class="odd">
<td style="text-align: left;">80119</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">H1102</td>
</tr>
<tr class="even">
<td style="text-align: left;">80119</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">H1102</td>
</tr>
<tr class="odd">
<td style="text-align: left;">44069</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">H0410</td>
</tr>
<tr class="even">
<td style="text-align: left;">20281</td>
<td style="text-align: left;">WEEKENDS/HOLIDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">H0388</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="aggregating-trips-based-on-hex_id" class="level2">
<h2 class="anchored" data-anchor-id="aggregating-trips-based-on-hex_id">Aggregating <code>TRIPS</code> based on <code>HEX_ID</code></h2>
<p>Next, we will add the <code>TRIPS</code> for all the bus stops within a hexagon. We will group via <code>HEX_ID</code>, <code>DAY_TYPE</code>, and <code>HOUR_OF_DAY</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> trips <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    HEX_ID,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    DAY_TYPE,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    HOUR_OF_DAY) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TRIPS =</span> <span class="fu">sum</span>(TRIPS))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trips))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: left;">DAY_TYPE</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: left;">WEEKDAY</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">122</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>trips</code> was processed from <em>Passenger Volume By Origin Destination Bus Stops</em>, which has almost <strong>6 million</strong> observations.</p>
<p>We now have a more lightweight dataset with almost <strong>60,000</strong> observations, which is about <strong>100x smaller</strong>.</p>
<p>Let’s save this data as an <code>rds</code> file so we don’t need to reprocess again later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(trips, <span class="st">"data/rds/trips202310.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="generating-time-series-cube-friendly-data" class="level1">
<h1>Generating time series cube-friendly data</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Load point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can run the rest of the document from this point by loading this data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/trips202310.rds"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>honeycomb <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/honeycomb202310.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>When doing <strong>Emerging Hotspot Analysis</strong> (EHSA), we need to create a time series cube. To do that we must pass the following criteria:</p>
<ul>
<li><p>It must have a row for each combination of <code>HEX_ID</code> (location) and <code>HOUR_OF_DAY</code> (time)</p></li>
<li><p>There are <strong>no missing</strong> values in <code>TRIPS</code> column</p></li>
</ul>
<div class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Is our <em>trips</em> <strong>data time series cube-friendly? The answer is NO.</strong>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spacetime</span>(trips, honeycomb,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">.loc_col =</span> <span class="st">"HEX_ID"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">.time_col =</span> <span class="st">"HOUR_OF_DAY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is_spacetime_cube</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>We do not pass the first requirement for generating a time series cube</p>
<blockquote class="blockquote">
<p>It must have a row for each combination of <code>HEX_ID</code> (location) and <code>HOUR_OF_DAY</code> (time)</p>
</blockquote>
</div>
</div>
</div>
<section id="generating-the-combinations" class="level2">
<h2 class="anchored" data-anchor-id="generating-the-combinations">Generating the combinations</h2>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How many combinations are there? The answer is 36,456.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To satisfy the requirement of:</p>
<blockquote class="blockquote">
<p>It must have a row for each combination of <code>HEX_ID</code> (location) and <code>HOUR_OF_DAY</code> (time)</p>
</blockquote>
<p>We need to find out how many such combinations exist.</p>
<ul>
<li><p>There are <strong>1519</strong> <strong>hexagons</strong> in our <code>honeycomb</code></p></li>
<li><p>There are <strong>24 hours</strong> in a day</p></li>
</ul>
<p>Therefore, there are <span class="math inline">\(1519 \times 24 = 36,456\)</span> combinations. We will use this value to verify if we have the correct space time cube.</p>
</div>
</div>
</div>
<p>To generate the combinations, we will use <code>expand.grid()</code> and for us to provide the list possible values for <code>HEX_ID</code> and <code>HOUR_OF_DAY</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>combos <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">HEX_ID =</span> honeycomb<span class="sc">$</span>HEX_ID,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">HOUR_OF_DAY =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">23</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(combos[<span class="dv">20</span><span class="sc">:</span><span class="dv">29</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>combos</code> also has <strong>36,456</strong> rows, aligned with our expectations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(combos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 36456</code></pre>
</div>
</div>
<p>With this generated, we can use this as a glue to generate our time series cube.</p>
</section>
<section id="splitting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="splitting-the-data">Splitting the data</h2>
<p>As we want to do separate analysis for weekdays and weekends, we will split the data. We will also remove the <code>DAY_TYPE</code> column as we do not need it anymore. To do this, we have to <code>ungroup()</code> before removing as we use <code>DAY_TYPE</code> as filter.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Weekday</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Weekend/Holidays</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>trips_wkdy <span class="ot">&lt;-</span> trips <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> <span class="st">"WEEKDAY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(, <span class="sc">-</span>DAY_TYPE)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(trips_wkdy[<span class="dv">20</span><span class="sc">:</span><span class="dv">29</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">257</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">159</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">69</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">72</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>trips_wknd <span class="ot">&lt;-</span> trips <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DAY_TYPE <span class="sc">==</span> <span class="st">"WEEKENDS/HOLIDAY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(, <span class="sc">-</span>DAY_TYPE)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(trips_wknd[<span class="dv">20</span><span class="sc">:</span><span class="dv">29</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0002</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0003</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">35</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checking if split covers the full data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Let’s check the total rows in <code>trips_wkdy</code> and <code>trips_wknd</code> add up to the number of rows in <code>trips</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(trips_wkdy) <span class="sc">+</span> <span class="fu">nrow</span>(trips_wknd) <span class="sc">==</span> <span class="fu">nrow</span>(trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>There are no lost data so we can proceed to the next step.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data clear point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We do not need <code>trips</code> anymore as we will be using <code>trips_wkdy</code> and <code>trips_wknd</code> from this point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="filling-in-the-all-the-combos" class="level2">
<h2 class="anchored" data-anchor-id="filling-in-the-all-the-combos">Filling in the all the combos</h2>
<p>Now that we have separate data frames for weekday and weekend/holiday, we need to make sure that our data frame as all the combination in <code>combos</code>. We can do that by joining <code>trips_wkxx</code> with <code>combos</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Weekday</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Weekend/Holiday</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>trips_cube_wkdy <span class="ot">&lt;-</span> <span class="fu">left_join</span>(combos, trips_wkdy)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trips_cube_wkdy, <span class="at">n =</span> <span class="dv">24</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">122</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">224</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Check if the output has the same rows as <code>combos</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(trips_cube_wkdy) <span class="sc">==</span> <span class="fu">nrow</span>(combos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>trips_cube_wknd <span class="ot">&lt;-</span> <span class="fu">left_join</span>(combos, trips_wknd)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trips_cube_wknd, <span class="at">n =</span> <span class="dv">24</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Check if the output has the same rows as <code>combos</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(trips_cube_wknd) <span class="sc">==</span> <span class="fu">nrow</span>(combos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The data frames generated now passes</p>
<blockquote class="blockquote">
<p>It must have a row for each combination of <code>HEX_ID</code> (location) and <code>HOUR_OF_DAY</code> (time)</p>
</blockquote>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The data frames generated violate</p>
<blockquote class="blockquote">
<p>There are <strong>no missing</strong> values in <code>TRIPS</code> column</p>
</blockquote>
<p>This is because there are some <code>HOUR_OF_DAY</code> where the value of <code>TRIPS</code> is <code>NA</code>. We need to fill in these missing values.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data clear point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We do not need <code>trips_wkxx</code> anymore as we will be using <code>trips_cube_wkxx</code> from this point on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(trips_wkdy)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(trips_wknd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="filling-in-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="filling-in-missing-values">Filling in missing values</h2>
<p>Lastly, we need to fill in the missing values in <code>TRIPS</code>. This can be done by filtering the rows with <code>NA</code> and setting those to <strong>0</strong>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Weekday</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Weekend/Holiday</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>trips_cube_wkdy<span class="sc">$</span>TRIPS[<span class="fu">is.na</span>(trips_cube_wkdy<span class="sc">$</span>TRIPS)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trips_cube_wkdy, <span class="at">n =</span> <span class="dv">24</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">122</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">224</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>trips_cube_wknd<span class="sc">$</span>TRIPS[<span class="fu">is.na</span>(trips_cube_wknd<span class="sc">$</span>TRIPS)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(trips_cube_wknd, <span class="at">n =</span> <span class="dv">24</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HEX_ID</th>
<th style="text-align: right;">HOUR_OF_DAY</th>
<th style="text-align: right;">TRIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">H0001</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Is our data frame <strong>time series cube-friendly? The answer is YES.</strong>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Let us check of our data frame can be used to create spacetime cubes.</p>
<section id="weekend" class="level4">
<h4 class="anchored" data-anchor-id="weekend">Weekend</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spacetime</span>(trips_cube_wkdy, honeycomb,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">.loc_col =</span> <span class="st">"HEX_ID"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">.time_col =</span> <span class="st">"HOUR_OF_DAY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is_spacetime_cube</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="weekendholiday-2" class="level4">
<h4 class="anchored" data-anchor-id="weekendholiday-2">Weekend/Holiday</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spacetime</span>(trips_cube_wknd, honeycomb,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">.loc_col =</span> <span class="st">"HEX_ID"</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">.time_col =</span> <span class="st">"HOUR_OF_DAY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is_spacetime_cube</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Save point
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>trips_cube_wkxx</code> data is part the <a href="#goal-data-sets">Goal data sets</a> we need. Hence, we will save them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(trips_cube_wkdy, <span class="st">"data/rds/trips_cube_wkdy202310.rds"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(trips_cube_wknd, <span class="st">"data/rds/trips_cube_wknd202310.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>